<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="nav_community">Community</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="nav-logo"><a href="index.html" data-i18n="site_logo">British Daily Bible</a></div>
                <ul class="nav-links">
                    <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                    <li><a href="disciple-test.html" data-i18n="nav_test">AI Test</a></li>
                    <li><a href="faith-checkup.html" data-i18n="nav_checkup">Check</a></li>
                    <li><a href="community.html" data-i18n="nav_community">Community</a></li>
                    <li><a href="chat.html" data-i18n="nav_chat">Paul AI</a></li>
                    <li><a href="blog.html" data-i18n="nav_blog">Blog</a></li>
                </ul>
                <div class="lang-switcher">
                    <select id="lang-select" onchange="applyLanguage(this.value)" style="padding: 8px 12px; border-radius: 20px; border: 1px solid #ddd; background: white;">
                        <option value="en">EN</option><option value="ko">KO</option>
                    </select>
                </div>
            </nav>
        </div>
    </header>

    <main class="container" style="padding: 60px 0;">
        <h1 data-i18n="prayer_request_title" style="text-align: center; margin-bottom: 40px;">üôè Prayer Requests</h1>
        <div class="card" style="max-width: 700px; margin: 0 auto 60px;">
            <input type="text" id="prayer-name" class="input-box" data-i18n="placeholder_name" placeholder="Name">
            <textarea id="prayer-content" class="input-box" data-i18n="placeholder_prayer" placeholder="Prayer request..." style="height: 120px; margin-top: 15px;"></textarea>
            <button onclick="submitPrayerRequest()" class="primary-btn" style="width: 100%; margin-top: 15px;" data-i18n="btn_submit_prayer">Submit Request</button>
        </div>
        <div id="prayer-wall-list"></div>

        <hr style="margin: 60px 0; border: 0; border-top: 1px dashed #B08968;">

        <div class="card" style="max-width: 700px; margin: 0 auto;">
            <h2 data-i18n="contact_form_title" style="text-align: center; margin-bottom: 25px;">ü§ù Partnership & Intercession</h2>
            <form action="https://formspree.io/f/mnjbvgdq" method="POST">
                <div style="margin-bottom: 15px;">
                    <label data-i18n="label_category" style="display: block; margin-bottom: 5px; color: #34495E; font-weight: 600;">Category</label>
                    <select name="category" class="input-box" required style="width: 100%; border: 1px solid #E0D7C6; padding: 12px; border-radius: 8px; background: #fff;">
                        <option value="Partnership" data-i18n="opt_partnership">Partnership Inquiry</option>
                        <option value="Intercession" data-i18n="opt_intercession">Intercessory Prayer Request</option>
                        <option value="Other" data-i18n="opt_other">Other Inquiry</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label data-i18n="label_name" style="display: block; margin-bottom: 5px; color: #34495E; font-weight: 600;">Name / Organization</label>
                    <input type="text" name="name" class="input-box" required placeholder="Name" data-i18n="placeholder_name">
                </div>
                <div style="margin-bottom: 15px;">
                    <label data-i18n="label_email" style="display: block; margin-bottom: 5px; color: #34495E; font-weight: 600;">Email Address</label>
                    <input type="email" name="_replyto" class="input-box" required placeholder="example@email.com">
                </div>
                <div style="margin-bottom: 20px;">
                    <label data-i18n="label_message" style="display: block; margin-bottom: 5px; color: #34495E; font-weight: 600;">Message</label>
                    <textarea name="message" class="input-box" required placeholder="Your message..." style="height: 150px;" data-i18n="placeholder_message"></textarea>
                </div>
                <button type="submit" class="primary-btn" style="width: 100%;" data-i18n="btn_send">Send Message</button>
            </form>
        </div>
    </main>

    <script defer src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="translations.js"></script>
    <script defer src="firebase-firestore-service.js"></script>
    <script defer src="main.js"></script>
    <script>
        window.submitPrayerRequest = async function() {
            const name = document.getElementById('prayer-name').value.trim();
            const content = document.getElementById('prayer-content').value.trim();
            if(!content) return;
            try {
                await window.db.collection("prayer_requests").add({
                    name: name || "Anonymous", content, timestamp: firebase.firestore.FieldValue.serverTimestamp(), prayCount: 0
                });
                document.getElementById('prayer-content').value = '';
            } catch (e) { console.error(e); }
        };
        document.addEventListener('DOMContentLoaded', () => {
            const check = setInterval(() => {
                if(window.db) {
                    clearInterval(check);
                    window.db.collection("prayer_requests").orderBy("timestamp", "desc").limit(20).onSnapshot(snap => {
                        const list = document.getElementById('prayer-wall-list');
                        list.innerHTML = "";
                        snap.forEach(doc => {
                            const data = doc.data();
                            list.innerHTML += `<div class="card" style="margin-bottom:15px;"><strong>${data.name}</strong><p>${data.content}</p></div>`;
                        });
                    });
                }
            }, 500);
        });
    </script>
</body>
</html>