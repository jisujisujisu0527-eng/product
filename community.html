<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="nav_community">Community</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="main-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-light); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease;">
        <i class="fas fa-cross fa-3x" style="color: var(--accent-color); margin-bottom: 20px; animation: pulse 2s infinite;"></i>
        <div data-i18n="nav_community" style="font-family: 'Lora', serif; color: var(--primary-color); font-size: 1.2rem;">Community</div>
    </div>

    <header>
        <div class="container">
            <nav class="navbar">
                <div class="nav-logo"><a href="index.html" data-i18n="site_logo">British Daily Bible</a></div>
                <ul class="nav-links">
                    <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                    <li><a href="community.html" data-i18n="nav_community">Community</a></li>
                    <li><a href="chat.html" data-i18n="nav_chat">Apostle Chat</a></li>
                </ul>
                <div class="lang-switcher">
                    <select id="lang-select" onchange="applyLanguage(this.value)" style="padding: 5px 10px; border-radius: 15px; background: var(--bg-light); border: 1px solid var(--accent-color); color: var(--primary-color);">
                        <option value="en">EN</option><option value="ko">KO</option>
                    </select>
                </div>
            </nav>
        </div>
    </header>

    <main class="container" style="padding: 40px 20px;">
        <div class="board-container">
            <h2 data-i18n="qna_title">üôè Faith Q&A</h2>
            <div class="card">
                <input type="text" id="qna-name" class="input-box" data-i18n="nickname" placeholder="Nickname">
                <textarea id="qna-content" class="input-box" data-i18n="qna_placeholder" placeholder="Your questions..."></textarea>
                <button class="primary-btn" onclick="savePost('qna')" style="width: 100%;" data-i18n="qna_btn">Ask</button>
            </div>
            <div id="qna-list" style="margin-top: 30px;"></div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="translations.js"></script>
    <script src="firebase-firestore-service.js"></script>
    <script src="main.js"></script>
    <script>
        // Community Logic (Non-module)
        window.savePost = async function(type) {
            if(!window.db) return;
            const name = document.getElementById(type + '-name').value.trim();
            const content = document.getElementById(type + '-content').value.trim();
            if(!content) return;

            try {
                await window.db.collection("posts").add({
                    type, name: name || "Anonymous", content, timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById(type + '-content').value = '';
            } catch (e) { console.error(e); }
        };

        // Real-time listener
        document.addEventListener('DOMContentLoaded', () => {
            if(!window.db) return;
            window.db.collection("posts").orderBy("timestamp", "desc").limit(20).onSnapshot((snap) => {
                const list = document.getElementById('qna-list');
                if(!list) return;
                list.innerHTML = "";
                snap.forEach(doc => {
                    const data = doc.data();
                    list.innerHTML += `<div class="post-card"><strong>${data.name}</strong><p>${data.content}</p></div>`;
                });
            });
        });
    </script>
</body>
</html>