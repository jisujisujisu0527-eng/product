<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="nav_chat">Chat with Paul</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .chat-container { max-width: 600px; margin: 40px auto; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid #eee; }
        .chat-header { background: #4a3b2a; padding: 30px; text-align: center; color: white; }
        .chat-header img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #fff; margin-bottom: 15px; background: #fff; }
        .chat-window { height: 450px; overflow-y: auto; padding: 20px; background: #fdfaf5; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 18px; border-radius: 15px; max-width: 80%; line-height: 1.6; }
        .bot-msg { background: #fff; align-self: flex-start; border: 1px solid #eee; color: #444; border-bottom-left-radius: 2px; }
        .user-msg { background: #B08968; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-input-area { display: flex; padding: 20px; background: white; border-top: 1px solid #eee; gap: 10px; }
    </style>
</head>
<body>
    <div id="main-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-light); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease;">
        <i class="fas fa-cross fa-3x" style="color: var(--accent-color); margin-bottom: 20px; animation: pulse 2s infinite;"></i>
        <div data-i18n="nav_chat" style="font-family: 'Lora', serif; color: var(--primary-color); font-size: 1.2rem;">Chat with Paul</div>
    </div>

    <header>
        <div class="container">
            <nav class="navbar">
                <div class="nav-logo">
                    <a href="index.html" data-i18n="site_logo">British Daily Bible</a>
                </div>
                <ul class="nav-links">
                    <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                    <li><a href="disciple-test.html" data-i18n="nav_test">AI Disciple</a></li>
                    <li><a href="faith-checkup.html" data-i18n="nav_checkup">Faith Check</a></li>
                    <li><a href="faith-dashboard.html" data-i18n="nav_dashboard">Dashboard</a></li>
                    <li><a href="community.html" data-i18n="nav_community">Community</a></li>
                    <li><a href="chat.html" data-i18n="nav_chat">Apostle Chat</a></li>
                </ul>
                <div class="lang-switcher">
                    <div id="streak-badge" style="display:none; margin-right: 15px; font-size: 0.8rem; font-weight: bold; color: #E65100;">
                        <i class="fas fa-fire"></i> <span id="streak-count">0</span>
                    </div>
                    <select id="lang-select" onchange="applyLanguage(this.value)" style="padding: 5px 10px; border-radius: 15px; background: var(--bg-light); border: 1px solid var(--accent-color); color: var(--primary-color); font-family: inherit;">
                        <option value="en">EN</option>
                        <option value="ko">KO</option>
                        <option value="fr">FR</option>
                        <option value="es">ES</option>
                    </select>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="chat-container">
                <div class="chat-header">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Paul&top=shortHair&topProbability=100&facialHair=beardMajestic&facialHairProbability=100&clothes=graphicShirt&clothColor=65c9ff" alt="Apostle Paul">
                    <h2 data-i18n="chat_title">Chat with Paul</h2>
                    <p data-i18n="chat_subtitle">Grace and peace to you</p>
                </div>
                <div id="chat-window" class="chat-window">
                    <div class="msg bot-msg" data-i18n="chat_welcome">Welcome message...</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" class="input-box" data-i18n="chat_placeholder" placeholder="Ask Paul..." style="margin-bottom: 0;">
                    <button onclick="sendChatMessage()" class="primary-btn">
                        <i class="fas fa-paper-plane"></i> <span data-i18n="chat_send">Send</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="translations.js"></script>
    <script type="module" src="firebase-firestore-service.js"></script>
    <script type="module" src="main.js" defer></script>
    <script type="module">
        const t = (key) => (translations[currentLang] || translations['en'])[key] || key;

        window.sendChatMessage = async function() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            appendMessage('user-msg', message);
            input.value = '';
            setTimeout(() => {
                const list = {
                    ko: ["아무 것도 염려하지 말고 다만 모든 일에 기도와 간구로..."],
                    en: ["Do not be anxious about anything, but in everything by prayer..."]
                };
                const res = (list[currentLang] || list['en'])[0];
                appendMessage('bot-msg', res);
            }, 800);
        };

        function appendMessage(type, text) {
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.textContent = text;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        }
    </script>
</body>
</html>